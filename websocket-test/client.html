<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>WebSocket 클라이언트</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
			}
			#messages {
				height: 300px;
				border: 1px solid #ccc;
				overflow-y: auto;
				padding: 10px;
				margin-bottom: 10px;
				background-color: #f9f9f9;
			}
			#messageInput {
				width: 70%;
				padding: 8px;
				margin-right: 10px;
			}
			button {
				padding: 8px 16px;
				background-color: #007bff;
				color: white;
				border: none;
				cursor: pointer;
			}
			button:hover {
				background-color: #0056b3;
			}
			.status {
				margin-bottom: 10px;
				padding: 10px;
				border-radius: 4px;
			}
			.connected {
				background-color: #d4edda;
				color: #155724;
			}
			.disconnected {
				background-color: #f8d7da;
				color: #721c24;
			}
		</style>
	</head>
	<body>
		<h1>WebSocket 클라이언트</h1>

		<div id="status" class="status disconnected">
			연결 상태: 연결되지 않음
		</div>

		<div id="messages"></div>

		<div>
			<input
				type="text"
				id="messageInput"
				placeholder="메시지를 입력하세요..."
			/>
			<button onclick="sendMessage()">전송</button>
			<button onclick="connect()">연결</button>
			<button onclick="disconnect()">연결 해제</button>
		</div>

		<script>
			let ws = null;
			const messagesDiv = document.getElementById("messages");
			const statusDiv = document.getElementById("status");
			const messageInput = document.getElementById("messageInput");

			function connect() {
				if (ws && ws.readyState === WebSocket.OPEN) {
					addMessage("이미 연결되어 있습니다.");
					return;
				}

				ws = new WebSocket("ws://localhost:3000");

				ws.onopen = function () {
					updateStatus(true);
					addMessage("서버에 연결되었습니다.");
				};

				ws.onmessage = function (event) {
					addMessage("서버로부터: " + event.data);
				};

				ws.onclose = function () {
					updateStatus(false);
					addMessage("서버와의 연결이 종료되었습니다.");
				};

				ws.onerror = function (error) {
					addMessage("에러 발생: " + error);
				};
			}

			function disconnect() {
				if (ws) {
					ws.close();
					ws = null;
				}
			}

			function sendMessage() {
				const message = messageInput.value.trim();
				if (!message) return;

				if (ws && ws.readyState === WebSocket.OPEN) {
					ws.send(message);
					addMessage("클라이언트에서: " + message);
					messageInput.value = "";
				} else {
					addMessage("서버에 연결되어 있지 않습니다.");
				}
			}

			function addMessage(message) {
				const messageElement = document.createElement("div");
				messageElement.textContent =
					new Date().toLocaleTimeString() + " - " + message;
				messagesDiv.appendChild(messageElement);
				messagesDiv.scrollTop = messagesDiv.scrollHeight;
			}

			function updateStatus(connected) {
				if (connected) {
					statusDiv.textContent = "연결 상태: 연결됨";
					statusDiv.className = "status connected";
				} else {
					statusDiv.textContent = "연결 상태: 연결되지 않음";
					statusDiv.className = "status disconnected";
				}
			}

			// Enter 키로 메시지 전송
			messageInput.addEventListener("keypress", function (e) {
				if (e.key === "Enter") {
					sendMessage();
				}
			});

			// 페이지 로드 시 자동 연결
			window.onload = function () {
				connect();
			};
		</script>
	</body>
</html>
